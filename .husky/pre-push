#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Kiá»ƒm tra náº¿u Ä‘ang push lÃªn master branch
protected_branch='master'
current_branch=$(git symbolic-ref HEAD | sed -e 's,.*/\(.*\),\1,')

echo "ğŸŒ¿ Current branch: $current_branch"
echo "ğŸ”’ Protected branch: $protected_branch"

if [ "$protected_branch" = "$current_branch" ]; then
  echo "ğŸš« Direct push to master branch is not allowed!"
  echo "ğŸ“‹ Please follow these steps:"
  echo "   1. Create a feature branch: git checkout -b feature/your-feature"
  echo "   2. Make your changes and commit them"
  echo "   3. Push the feature branch: git push origin feature/your-feature"
  echo "   4. Create a Pull Request to merge into master"
  exit 1
fi

# Cháº¡y validation Ä‘áº§y Ä‘á»§ trÆ°á»›c khi push
echo "ğŸ” Running pre-push validation..."

# Kiá»ƒm tra lint vÃ  format
echo "ğŸ“ Checking code style..."
npm run lint:check
npm run format:check

# Kiá»ƒm tra TypeScript compilation
echo "ğŸ”§ Checking TypeScript compilation..."
npm run build

# Kiá»ƒm tra Prisma schema
echo "ğŸ—„ï¸ Validating Prisma schema..."
npx prisma validate

# Cháº¡y tests
echo "ğŸ§ª Running tests..."
npm run test

echo "âœ… Pre-push validation passed!"
echo "ğŸš€ Ready to push to branch: $current_branch"