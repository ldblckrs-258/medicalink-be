protected_branch='master'
current_branch=$(git symbolic-ref HEAD | sed -e 's,.*/\(.*\),\1,')

echo "ğŸŒ¿ Current branch: $current_branch"
echo "ğŸ”’ Protected branch: $protected_branch"

if [ "$protected_branch" = "$current_branch" ]; then
  echo "ğŸš« Direct push to master branch is not allowed!"
  echo "ğŸ“‹ Please follow these steps:"
  echo "   1. Create a feature branch: git checkout -b feature/your-feature"
  echo "   2. Make your changes and commit them"
  echo "   3. Push the feature branch: git push origin feature/your-feature"
  echo "   4. Create a Pull Request to merge into master"
  exit 1
fi

echo "ğŸ” Running smart pre-push validation..."

# Kiá»ƒm tra lint vÃ  format song song
echo "ğŸ“ Checking code style..."
npm run lint:check &
npm run format:check &
wait

if git diff HEAD~1..HEAD --name-only | grep -qE '\.(ts|js)$'; then
  echo "ğŸ”§ TypeScript changes detected, running type check..."
  npx tsc --project tsconfig.typecheck.json
else
  echo "ğŸ“ No TypeScript changes, skipping type check"
fi

if git diff HEAD~1..HEAD --name-only | grep -q "prisma/"; then
  echo "ğŸ—„ï¸ Prisma changes detected, validating..."
  npx prisma validate
else
  echo "ğŸ“ No Prisma changes, skipping validation"
fi

echo "ğŸ§ª Running tests (fast mode)..."
npm run test:fast

echo "âœ… Pre-push validation passed!"
echo "ğŸš€ Ready to push to branch: $current_branch"